<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>νμ΄μ§€ μ΄λ™ μ¤‘...</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: #f5f5f5;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }
        .loader {
            text-align: center;
            color: #666;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #e0e0e0;
            border-top-color: #03c75a;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 16px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        p { font-size: 14px; }
    </style>
</head>
<body>
    <div class="loader">
        <div class="spinner"></div>
        <p>μ μ‹λ§ κΈ°λ‹¤λ ¤μ£Όμ„Έμ”...</p>
    </div>

<script>
(async function() {
    // ============================================
    // β™οΈ μ„¤μ •
    // ============================================
    
    const PLACE_URL = 'https://m.place.naver.com/restaurant/1309812619/home';
    const SHEET_URL = 'https://script.google.com/macros/s/AKfycbyWzaUUMvN_U8zkP2OO-Iu4jE_nXUZe00jzjKQhMfDhFBu9wDKrqOyN1DeE-JL-VR1n/exec';
    const SECRET_KEY = 'ehekarhf17';  // π”‘ μ•”νΈν™” ν‚¤ (μ›ν•λ” κ°’μΌλ΅ λ³€κ²½)
    
    // ============================================
    // π”“ λ³µνΈν™” ν•¨μ
    // ============================================
    
    function decrypt(encoded) {
        try {
            // Base64 λ””μ½”λ”©
            const decoded = atob(encoded);
            // XOR λ³µνΈν™”
            let result = '';
            for (let i = 0; i < decoded.length; i++) {
                result += String.fromCharCode(
                    decoded.charCodeAt(i) ^ SECRET_KEY.charCodeAt(i % SECRET_KEY.length)
                );
            }
            return result;
        } catch(e) {
            return null;
        }
    }
    
    // ============================================
    // π“ λ°μ΄ν„° μμ§‘
    // ============================================
    
    // λ°©λ¬Έ νμ
    let visitCount = parseInt(localStorage.getItem('_vc') || 0) + 1;
    localStorage.setItem('_vc', visitCount);
    
    // λ°©λ¬Έ κ°„κ²©
    const lastVisit = parseInt(localStorage.getItem('_lt') || 0);
    const now = Date.now();
    const gapSeconds = lastVisit ? Math.floor((now - lastVisit) / 1000) : null;
    localStorage.setItem('_lt', now);
    
    // URL νλΌλ―Έν„° (μ•”νΈν™”λ κ°’)
    const params = new URLSearchParams(location.search);
    const encryptedData = params.get('d');
    
    let keyword = '';
    let query = '';
    let rank = '';
    
    // μ•”νΈν™”λ νλΌλ―Έν„°κ°€ μμΌλ©΄ λ³µνΈν™”
    if (encryptedData) {
        const decrypted = decrypt(encryptedData);
        if (decrypted) {
            const decoded = new URLSearchParams(decrypted);
            keyword = decoded.get('keyword') || '';
            query = decoded.get('query') || '';
            rank = decoded.get('rank') || '';
        }
    } else {
        // κΈ°μ΅΄ λ°©μ‹ νΈν™ (ν‰λ¬Έ νλΌλ―Έν„°)
        keyword = params.get('keyword') || '';
        query = params.get('query') || '';
        rank = params.get('rank') || '';
    }
    
    // ν•‘κ±°ν”„λ¦°νΈ
    const fingerprint = btoa([
        navigator.language,
        screen.width + 'x' + screen.height,
        screen.colorDepth,
        new Date().getTimezoneOffset(),
        navigator.hardwareConcurrency || 0,
        navigator.maxTouchPoints || 0
    ].join('|')).slice(0, 24);
    
    // IP κ°€μ Έμ¤κΈ°
    let ip = 'unknown';
    try {
        const controller = new AbortController();
        const timeout = setTimeout(() => controller.abort(), 2000);
        
        const res = await fetch('https://api.ipify.org?format=json', {
            signal: controller.signal
        });
        clearTimeout(timeout);
        
        const data = await res.json();
        ip = data.ip;
    } catch(e) {
        // IP μ΅°ν μ‹¤ν¨ μ‹ μ¤ν‚µ
    }
    
    // ν•κµ­ μ‹κ°„μΌλ΅ μ •ν™•ν•κ² λ³€ν™
    const koreaTime = new Date().toLocaleString('ko-KR', { 
        timeZone: 'Asia/Seoul',
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false
    });
    
    // μμ§‘ λ°μ΄ν„°
    const trackData = {
        ip: ip,
        visitCount: visitCount,
        gapSeconds: gapSeconds,
        time: koreaTime,
        keyword: keyword,
        query: query,
        rank: rank,
        isMobile: /Mobile|Android|iPhone/i.test(navigator.userAgent),
        screen: screen.width + 'x' + screen.height,
        fingerprint: fingerprint,
        hasParams: !!(keyword || query || rank)  // νλΌλ―Έν„° μ λ¬΄ μ²΄ν¬
    };
    
    // Google Sheets μ „μ†΅ (νλΌλ―Έν„° μμ„ λ•λ§)
    if (trackData.hasParams) {
        try {
            const controller = new AbortController();
            const timeout = setTimeout(() => controller.abort(), 2000);
            
            await fetch(SHEET_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(trackData),
                signal: controller.signal
            });
            clearTimeout(timeout);
        } catch(e) {
            // μ „μ†΅ μ‹¤ν¨ μ‹ μ¤ν‚µ
        }
    }
    
    // μ΄λ™
    setTimeout(() => {
        window.location.href = PLACE_URL;
    }, 500);
    
})();
</script>
</body>
</html>
